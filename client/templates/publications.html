<template name="publications">
  <h1>Publications</h1>
  <div class="row">
    <div class="col12 catalog">
      {{> catalogControls catalogSettings}}
      {{> noPublications}}
      {{> publicationsList documents}}
      {{> publicationsLoading}}
    </div>
    {{> myPublications}}
  </div>
</template>

<template name="publicationsList">
  {{#if this}}
    <ol class="item-list">
      {{#each this}}
        {{> publicationCatalogItem}}
      {{/each}}
    </ol>
  {{/if}}
</template>

<template name="noPublications">
  {{#if noDocuments}}
    <p class="status">
      {{#if documentsFilter}}
        The filter matches no publications.
      {{else}}
        There are no publications yet.
        {{#if currentPersonId}}
          Import the first from the menu on top.
        {{else}}
          Sign in and import the first.
        {{/if}}
      {{/if}}
    </p>
  {{/if}}
</template>

<template name="publicationsLoading">
  {{#if documentsLoading}}
    <p class="status">Loading â€¦</p>
  {{else}}
    {{#if moreDocuments}}
      <button class="load-more">Load more</button>
    {{/if}}
  {{/if}}
</template>

<template name="myPublications">
  <div class="col4 push12 sidebar">
    {{#if currentPersonId}}
      {{! TODO: Add user's publications}}
    {{/if}}
    {{> footer}}
  </div>
</template>

<template name="publicationInlineItem">
  {{#spaceless}}
    <a class="inline-item publication" {{#unless noLink}}href="{{publicationPathFromId _id slug}}"{{/unless}}>
      <i class="icon-publication" title="Publication"></i>
      <span class="name" title="{{name}}">
        {{#if title}}
          {{title}}
        {{else}}
          <i>&lt;title metadata missing&gt;</i>
        {{/if}}
      </span>
    </a>
  {{/spaceless}}
</template>

<template name="publicationCatalogItem">
  <li class="catalog-item publication" data-publication-id="{{_id}}">
    {{#if thumbnailUrls.length}}
      <div class="thumbnail actionable {{documentLengthClass}}">
        <ul class="scrubber">
          {{#each thumbnailUrls}}
            {{> publicationCatalogItemThumbnail}}
          {{/each}}
        </ul>
      </div>
    {{/if}}

    {{#if currentPersonId}}
      {{#spaceless}}
        <div class="toolbar actionable">
          {{> publicationCatalogItemLibraryMenu}}
        </div>
      {{/spaceless}}
    {{/if}}

    <div class="details">
      {{> publicationCatalogItemTitle}}

      <ol class="authors actionable">
        {{#if authors.length}}
          {{#each authors}}
            <li>{{> personInlineItem}}</li>
          {{/each}}
        {{else}}
          <li><i>&lt;author metadata missing&gt;</i></li>
        {{/if}}
      </ol>

      <p>{{createdDay}},
        {{#spaceless}}
          <span class="tooltip" title="
            {{#if open}}Everyone has access to the publication{{/if}}
            {{#if closed}}The publication is public, but only those who import the PDF have access to its content{{/if}}
            {{#if private}}Only the users who import the PDF or are listed have access to the publication{{/if}}
          ">
            {{> accessIcon}}{{> accessText}}
          </span>
        {{/spaceless}}
      </p>

      {{#if annotationsCount}}
        <p><i class="icon-annotation"></i> {{annotationsCountDescription}}</p>
      {{/if}}

      <div class="actions actionable">
        {{#if hasAbstract}}
          <button class="preview-link">Abstract</button> &middot;
        {{/if}}
        <a href="{{publicationPathFromId _id slug}}">Full text</a>
      </div>
    </div>

    <div class="extra-details">
      {{#if abstract}}
        <div class="abstract">
          <p class="abstract-content">{{abstract}}</p>
        </div>
      {{/if}}
    </div>

    <a class="full-item-link" href="{{publicationPathFromId _id slug}}"></a>
  </li>
</template>

<template name="publicationCatalogItemLibraryMenu">
  <div class="dropdown-trigger">
    <button class="toolbar-button tooltip" title="
      {{#if inLibrary}}
        Publication is in your library
      {{else}}
        Add publication to library and collections.
      {{/if}}
    ">
      <i class="{{#if inLibrary}}icon-bookmark{{else}}icon-bookmark-empty{{/if}}"></i>
    </button>
    <div class="dropdown-anchor">
      <div class="dropdown library-menu">
        {{> publicationLibraryMenuButtons}}
        {{> publicationLibraryMenuCollections}}
        {{> addNewCollection}}
      </div>
    </div>
  </div>
</template>

<template name="publicationCatalogItemTitle">
  <h2 class="{{#unless title}}{{#unless importing.0.filename}}missing-value{{/unless}}{{/unless}}">
    {{#spaceless}}
      <a class="actionable" href="{{publicationPathFromId _id slug}}">
        {{#if title}}
          {{title}}
        {{else}}
          {{#if importing.0.filename}}
            {{! Used only in personal library list, elsewhere we display "<title metadata missing>" to invite users to provide metadata }}
            {{importing.0.filename}}
          {{else}}
            <i>&lt;title metadata missing&gt;</i>
          {{/if}}
        {{/if}}
      </a>
    {{/spaceless}}
  </h2>
</template>

<template name="publicationCatalogItemThumbnail">
  <li><img src="{{this}}" width="95" height="125" alt="" title="Page {{page}}"></li>
</template>
