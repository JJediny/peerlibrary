<template name="publication">
  <div class="viewer">
    {{> publicationMetaMenu}}
    {{> publicationScroller}}
    {{> publicationDisplay}}
    {{> annotationsControl}}
    {{> publicationAnnotations}}
  </div>
</template>

<template name="publicationMetaMenu">
  <div class="meta-menu">
    <i class="icon-menu"></i>
    <div class="meta-content">
      <p><b>{{publication.title}}</b></p>
      <p class="authors">
        {{#each publication.authors}}
          <span><a href="{{profilePath slug}}">{{foreNames}} {{lastName}}</a></span>
        {{/each}}
      </p>
      <p>Published in: {{publication.source}}</p>
      <p>{{publication.created}}</p>
    </div>
  </div>
</template>

<template name="publicationDisplay">
  {{#constant}}
    <div class="display-wrapper"></div>
  {{/constant}}
</template>

<template name="publicationScroller">
  <div class="scroller">
    {{#each sections}}
      {{> publicationScrollerSection}}
    {{/each}}
    <div class="viewport"></div>
  </div>
</template>

<template name="publicationScrollerSection">
  <div class="section" style="height: {{heightPercentage}}%; top: {{topPercentage}}%"></div>
</template>

<template name="publicationAnnotations">
  <ul class="annotations">
    {{#each annotations}}
      {{> publicationAnnotationsItem}}
    {{/each}}
  </ul>
</template>

<template name="publicationAnnotationsItem">
  <li class="annotation">
    {{#if canEdit}}
      {{#constant}}
        <div class="body" contenteditable="true">
          {{body}}
        </div>
        <span class="saved">Saved</span>
      {{/constant}}
    {{else}}
      <div class="body">
        {{body}}
      </div>
    {{/if}}
    {{> annotationMetaMenu}}
  </li>
</template>

<template name="highlightsControl">
  {{#if canEdit}}
    <button class="delete">Delete</button>
  {{/if}}
  <p class="authors">
    {{#with author}}
      <span><a href="{{profilePath slug}}">{{foreNames}} {{lastName}}</a></span>
    {{/with}}
  </p>
  <p>{{created}}</p>
</template>

<template name="annotationsControl">
  <div class="annotations-control">
    <button class="add" title="Add an annotation">+</button>
  </div>
</template>

<template name="annotationMetaMenu">
  <div class="meta-menu">
    <i class="icon-menu"></i>
    <div class="meta-content">
      {{! TODO: Display delete buttons only to authors of annotations (for now) }}
      <button class="delete">Delete</button>
      <p class="authors">
        {{#with author}}
          <span><a href="{{profilePath slug}}">{{foreNames}} {{lastName}}</a></span>
        {{/with}}
      </p>
      <p>{{created}}</p>
      <p class="highlights">
        {{#each highlights}}
          <span><a href="{{highlightPathFromId _id}}">h:{{_id}}</a></span>
        {{else}}
          Not linked to any highlight.
        {{/each}}
      </p>
    </div>
  </div>
</template>
